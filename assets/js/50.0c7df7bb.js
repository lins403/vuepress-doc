(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{451:function(a,t,e){"use strict";e.r(t);var r=e(43),s=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"浏览器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器"}},[a._v("#")]),a._v(" 浏览器")]),a._v(" "),e("h2",{attrs:{id:"bom和dom"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#bom和dom"}},[a._v("#")]),a._v(" BOM和DOM")]),a._v(" "),e("ul",[e("li",[a._v("浏览器对象模型（Browser Object Model，简称 BOM），也就是 "),e("code",[a._v("window")]),a._v(" 对象")]),a._v(" "),e("li",[a._v("文档对象模型（Document Object Model，简称 DOM），也就是 "),e("code",[a._v("document")]),a._v(" 对象")])]),a._v(" "),e("h2",{attrs:{id:"浏览器分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器分析"}},[a._v("#")]),a._v(" 浏览器分析")]),a._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[a._v("console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("navigator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("userAgent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//用户代理")]),a._v("\n\n 浏览器\n 浏览器版本\n 浏览器渲染引擎\n "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("设备类型")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("桌面"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("移动"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n 设备生产商\n 设备型号\n 操作系统\n 操作系统版本\n\nconsole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("navigator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("platform"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nconsole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("navigator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("deviceMemory"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nconsole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("navigator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("hardwareConcurrency"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),e("h2",{attrs:{id:"离线存储"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#离线存储"}},[a._v("#")]),a._v(" 离线存储")]),a._v(" "),e("h3",{attrs:{id:"localstorage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#localstorage"}},[a._v("#")]),a._v(" localStorage")]),a._v(" "),e("ul",[e("li",[a._v("Chrome有5M大小限制")]),a._v(" "),e("li",[a._v("只支持字符串")])]),a._v(" "),e("h3",{attrs:{id:"indexeddb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb"}},[a._v("#")]),a._v(" indexedDB")]),a._v(" "),e("p",[a._v("Indexed Database API 简称 IndexedDB，是浏览器中存储"),e("u",[a._v("结构化数据")]),a._v("（也包括File/Blob）的一个方案。")]),a._v(" "),e("p",[a._v("IndexedDB 用于代替目前已废弃的 Web SQL Database API。")]),a._v(" "),e("p",[a._v("IndexedDB 背后的思想是创造一套 API，方便 JavaScript 对象的存储和获取，同时也支持查询和搜索。")]),a._v(" "),e("ul",[e("li",[a._v("实例："),e("a",{attrs:{href:"https://www.zhangxinxu.com/wordpress/2017/07/html5-indexeddb-js-example/",target:"_blank",rel:"noopener noreferrer"}},[a._v("HTML5 indexedDB前端本地存储数据库实例教程"),e("OutboundLink")],1)])]),a._v(" "),e("h3",{attrs:{id:"其它"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[a._v("#")]),a._v(" 其它")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Web SQL Database（已废弃）")])]),a._v(" "),e("li",[e("p",[a._v("CacheStorage（experimental）")])])]),a._v(" "),e("h3",{attrs:{id:"indexeddb-与-web-sql-database"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb-与-web-sql-database"}},[a._v("#")]),a._v(" indexedDB 与 Web SQL Database")]),a._v(" "),e("p",[e("code",[a._v("Web SQL Database")])]),a._v(" "),e("ul",[e("li",[a._v("关系型数据库，类似SQLite")]),a._v(" "),e("li",[a._v("事务操作要写SQL")])]),a._v(" "),e("p",[e("code",[a._v("indexedDB")])]),a._v(" "),e("ul",[e("li",[a._v("NoSQL数据库，一个基于 JavaScript 的面向对象数据库")]),a._v(" "),e("li",[a._v("写法对JS开发者更友好，存储和检索通过键来索引")]),a._v(" "),e("li",[a._v("异步执行操作，以免阻塞应用程序")])]),a._v(" "),e("h3",{attrs:{id:"indexeddb-与-localstorage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb-与-localstorage"}},[a._v("#")]),a._v(" indexedDB 与 localStorage")]),a._v(" "),e("ul",[e("li",[a._v("都是实现了客户端的离线存储，但是数据默认都没有加密，谨慎使用敏感信息")]),a._v(" "),e("li",[a._v("localStorage兼容IE8+，indexDB兼容IE10+")]),a._v(" "),e("li",[a._v("localStorage仅支持存储字符串，而indexDB几乎可以任何格式，包括图片的Blob数据（IE需要考虑兼容性）")]),a._v(" "),e("li",[a._v("indexDB可以在web workers 和 service workers中使用")]),a._v(" "),e("li",[a._v("使用 IndexedDB 执行的操作是异步执行的，而webStorage是同步阻塞的")])]),a._v(" "),e("h3",{attrs:{id:"localforage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#localforage"}},[a._v("#")]),a._v(" localForage")]),a._v(" "),e("ul",[e("li",[a._v("根据浏览器的支持情况，依次选择 "),e("code",[a._v("IndexedDB")]),a._v(" | "),e("code",[a._v("WebSQL")]),a._v(" | "),e("code",[a._v("localStorage")]),a._v(" 其中一种进行存储数据")]),a._v(" "),e("li",[a._v("类似 localStorage 的API风格")]),a._v(" "),e("li",[a._v("异步get和set，支持Promise和callback")])]),a._v(" "),e("p",[e("a",{attrs:{href:"https://localforage.docschina.org/#localforage",target:"_blank",rel:"noopener noreferrer"}},[a._v("localForage 中文文档"),e("OutboundLink")],1)]),a._v(" "),e("h2",{attrs:{id:"渲染原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#渲染原理"}},[a._v("#")]),a._v(" 渲染原理")]),a._v(" "),e("p",[a._v("The pixel pipeline:  "),e("u",[a._v("JavaScript > Style calculations > Layout > Paint > Composite")])]),a._v(" "),e("p",[a._v("像素管道：JavaScript » 样式计算 » 布局 » 绘制 » 合成")]),a._v(" "),e("p",[e("strong",[a._v("JavaScript")]),a._v("：使用 JavaScript 来实现一些视觉变化的效果")]),a._v(" "),e("p",[e("strong",[a._v("样式计算")]),a._v("：匹配selectors，应用css规则，计算每个元素的最终样式")]),a._v(" "),e("p",[e("strong",[a._v("布局")]),a._v("：计算它要占据的空间大小及其在屏幕的位置")]),a._v(" "),e("p",[e("strong",[a._v("绘制")]),a._v("：创建绘图调用的列表（a list of draw calls），填充像素（栅格化rasterize），绘制多个图层")]),a._v(" "),e("p",[e("strong",[a._v("合成")]),a._v("：合成多个图层")]),a._v(" "),e("p",[a._v("为了确保平滑滚动和动画，占据"),e("u",[e("strong",[a._v("主线程")])]),a._v("的所有内容，包括计算样式，以及reflow和paint，必须让浏览器在"),e("u",[e("strong",[a._v("60帧（16.67毫秒）")])]),a._v("内完成。为了确保重绘repaint的速度比初始绘制的速度更快，屏幕上的绘图通常被分解成数层。如果发生这种情况，则需要进行合成。")]),a._v(" "),e("p",[a._v("绘制可以将Layout tree中的元素分解为多个层。将内容提升到GPU上的层，可以提高绘制和重绘的性能。")]),a._v(" "),e("p",[a._v("渲染进程："),e("u",[a._v("主线程 (main thread)、合成线程 (compositor thread)")]),a._v("、栅格线程")]),a._v(" "),e("h2",{attrs:{id:"重排和重绘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重排和重绘"}},[a._v("#")]),a._v(" 重排和重绘")]),a._v(" "),e("h3",{attrs:{id:"重排reflow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重排reflow"}},[a._v("#")]),a._v(" 重排reflow")]),a._v(" "),e("blockquote",[e("p",[e("em",[a._v("Reflow")]),a._v(" is any subsequent size and position determination of any part of the page or the entire document.")]),a._v(" "),e("p",[a._v("The first time the size and position of nodes are determined is called "),e("em",[a._v("layout")]),a._v(". Subsequent recalculations of node size and locations are called "),e("em",[a._v("reflows")]),a._v(".")])]),a._v(" "),e("p",[a._v("修改了元素的layout属性，影响到其它元素的布局，例如  width, height, position 等等")]),a._v(" "),e("p",[a._v("Recalculate Style--\x3eLayout--\x3eUpdate Layer Tree--\x3e以及之后各个流程")]),a._v(" "),e("h3",{attrs:{id:"重绘repaint"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重绘repaint"}},[a._v("#")]),a._v(" 重绘repaint")]),a._v(" "),e("p",[a._v("修改了元素的“paint only”属性，不会影响到页面布局，例如 background, text color, shadows 等等，浏览器的渲染会掉过布局，直接进行绘制")]),a._v(" "),e("p",[a._v("Recalculate Style--\x3eUpdate Layer Tree--\x3e以及之后各个流程")]),a._v(" "),e("h3",{attrs:{id:"影响重排重绘的属性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#影响重排重绘的属性"}},[a._v("#")]),a._v(" 影响重排重绘的属性")]),a._v(" "),e("p",[e("a",{attrs:{href:"http://goo.gl/lPVJY6",target:"_blank",rel:"noopener noreferrer"}},[a._v("CSS properties by style operation required - Google "),e("OutboundLink")],1)]),a._v(" "),e("h4",{attrs:{id:"特殊"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特殊"}},[a._v("#")]),a._v(" 特殊")]),a._v(" "),e("ul",[e("li",[a._v("滚动")]),a._v(" "),e("li",[e("u",[a._v("opacity、transform")]),a._v("（通过transform实现的动画不需要进行样式计算、布局和绘制等操作）")])]),a._v(" "),e("p",[a._v("既不要布局也不要绘制，浏览器会跳过布局和绘制，直接执行合成")]),a._v(" "),e("h3",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),e("p",[a._v("重排和重绘都是占用浏览器主线程，主线程JavaScript的执行可能就会给页面的重排和重绘造成影响，造成下一帧的画面不能按时渲染， 例如导致动画卡顿")]),a._v(" "),e("hr"),a._v(" "),e("p",[a._v("我觉得有不少歧义，按MDN的解释加之我的理解，浏览器会解析css构建CSSOM，然后和DOM树一起合并（combined）生成render tree，随后执行layout布局，去遍历render tree，确定树中每个node的size和position，依照每个元素的盒模型属性进行排列，这样子才得到了Layout tree。")]),a._v(" "),e("p",[a._v("paint阶段就是将Layout tree上的每个box转换成页面上的实际像素。")]),a._v(" "),e("p",[a._v("而为了保证能在60帧内完成渲染，需要确保重绘的性能比原始绘制时高，paint阶段会将layout tree的元素取出分成多个图层，不同图层相互重叠的时候就要合成（composite），按照绘制顺序合成多个图层，然后展示到屏幕上。")]),a._v(" "),e("p",[a._v("把图层分块（tile），对每个块单独栅格化，填充像素到位图上，生成一帧，然后上传GPU。按MDN说的，图层当是将内容提升到GPU上的层。")]),a._v(" "),e("p",[e("code",[a._v("<canvas>")]),a._v(" 和 "),e("code",[a._v("<video>")]),a._v("，以及使用 "),e("code",[a._v("opacity")]),a._v(" 和 "),e("code",[a._v("transform")]),a._v(" 这些css属性的元素，可以实例化一个图层（instantiate a layer），这些元素和它们的后代节点，都会在这个图层上独立进行绘制，从而避开了主线程中的layout与paint环节。")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/Performance/How_browsers_work",target:"_blank",rel:"noopener noreferrer"}},[a._v("Populating the page: how browsers work"),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("requestAnimationFrame我看到别的博客提到节流效果，用节流解释太妙了。")]),a._v(" "),e("h2",{attrs:{id:"技巧"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#技巧"}},[a._v("#")]),a._v(" 技巧")]),a._v(" "),e("p",[e("code",[a._v("Cmd+Shft+R")]),a._v(" 无缓存重载页面")])])}),[],!1,null,null,null);t.default=s.exports}}]);