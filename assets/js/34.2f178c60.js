(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{435:function(t,a,e){"use strict";e.r(a);var s=e(43),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"gitlab-ci-cd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-cd"}},[t._v("#")]),t._v(" GitLab CI/CD")]),t._v(" "),e("h2",{attrs:{id:"pipeline"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pipeline"}},[t._v("#")]),t._v(" Pipeline")]),t._v(" "),e("p",[t._v("A typical pipeline might consist of four stages, executed in the following order:")]),t._v(" "),e("ul",[e("li",[t._v("A "),e("code",[t._v("build")]),t._v(" stage, with a job called "),e("code",[t._v("compile")]),t._v(".")]),t._v(" "),e("li",[t._v("A "),e("code",[t._v("test")]),t._v(" stage, with two jobs called "),e("code",[t._v("test1")]),t._v(" and "),e("code",[t._v("test2")]),t._v(".")]),t._v(" "),e("li",[t._v("A "),e("code",[t._v("staging")]),t._v(" stage, with a job called "),e("code",[t._v("deploy-to-stage")]),t._v(".")]),t._v(" "),e("li",[t._v("A "),e("code",[t._v("production")]),t._v(" stage, with a job called "),e("code",[t._v("deploy-to-prod")]),t._v(".")])]),t._v(" "),e("h2",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),e("p",[e("code",[t._v(".gitlab-ci.yml")])]),t._v(" "),e("p",[t._v("Check your .gitlab-ci.yml : <project-url>/ci/lint")]),t._v(" "),e("div",{staticClass:"language-yml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm install "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("force\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules/\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("unit_test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("unit\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("after_script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "test passed."\n')])])]),e("h3",{attrs:{id:"runner"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#runner"}},[t._v("#")]),t._v(" Runner")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://docs.gitlab.com/runner/install/osx.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Install GitLab Runner on macOS | GitLab"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\nbrew "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gitlab-runner\nbrew services start gitlab-runner\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册")]),t._v("\ngitlab-runner register\n")])])]),e("ul",[e("li",[t._v("executor选用shell")]),t._v(" "),e("li",[t._v("executor选用docker\timage: node:14.18.2")])]),t._v(" "),e("h2",{attrs:{id:"cache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cache"}},[t._v("#")]),t._v(" cache")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/caching/index.html#common-use-cases-for-caches",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caching in GitLab CI/CD | GitLab"),e("OutboundLink")],1)])]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" test"),e("span",{pre:!0,attrs:{class:"token important"}},[t._v("&build")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cache")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# branch > stages > jobs")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# between jobs, per-branch")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $CI_COMMIT_REF_SLUG\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 内置的运行时predefined variables，我觉得就是分支名")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# between branches, per-job:")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $CI_JOB_NAME\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# per-job, per-branch")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"')]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# per-stage, per-branch")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$CI_JOB_STAGE-$CI_COMMIT_REF_SLUG"')]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# To share a cache across all branches and all jobs, use the same key for everything")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" one"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("to"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("them"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("all\n  \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("policy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pull"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("push\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#by default")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the job downloads the cache when the job starts, and uploads changes to the cache when the job ends.")]),t._v("\n  \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" .npm/\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm ci "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cache .npm "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prefer"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("offline\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# --prefer-offline, 离线优先, disables online checks of cached packages.")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" npm run test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("unit\n")])])]),e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://docs.gitlab.com/ee/development/cicd/templates.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Development guide for GitLab CI/CD templates | GitLab"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Keyword reference for the .gitlab-ci.yml file | GitLab"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.cnblogs.com/cjsblog/p/12256843.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitLab CI/CD - 废物大师兄 - 博客园"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://dev.to/marcinwosinek/series/13834",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitLab Series' Articles - DEV Community"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);