(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{424:function(t,e,s){"use strict";s.r(e);var r=s(43),a=Object(r.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目"}},[t._v("#")]),t._v(" 项目")]),t._v(" "),s("h2",{attrs:{id:"鉴权方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#鉴权方式"}},[t._v("#")]),t._v(" 鉴权方式")]),t._v(" "),s("h3",{attrs:{id:"双重鉴权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#双重鉴权"}},[t._v("#")]),t._v(" 双重鉴权")]),t._v(" "),s("ul",[s("li",[t._v("前端在请求的header中添加一个"),s("strong",[t._v("Authorization")]),t._v("字段，存的是base64位加密过的一串标识符，后端会优先检测这个")]),t._v(" "),s("li",[t._v("然后再添加另外一个"),s("strong",[t._v("Auth")]),t._v("字段，存的是登录验证通过以后后端接口发来的access token（同时还有refresh token），其实是jwt token，请求的时候发送给后端做校验。这个access token过期时就用refresh token去刷新。")]),t._v(" "),s("li",[t._v("定时每十秒检测access token，过期了就用refresh token去刷新\n"),s("ul",[s("li",[t._v("token被存在localStorage中，并且存储时设置了一个dateTime字段表示当时写的时间，然后用当前时间减去dateTime计算的时间差，超过设置的超时时间时则表示过期，然后用refresh token去刷新")])])])]),t._v(" "),s("p",[t._v("我们会去获取按钮的权限列表，就是菜单了，在后台配置的，然后通过接口来拉取")]),t._v(" "),s("h3",{attrs:{id:"表单按钮的权限功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表单按钮的权限功能"}},[t._v("#")]),t._v(" 表单按钮的权限功能")]),t._v(" "),s("p",[t._v("登录以后取到后端发来的access token，然后给http header添加一个字段用来存这个token，在后续所有的请求中都带上这个token，其实是一个jwt token。然后我们通过接口读取菜单列表的时候，后端解析这个token，然后根据角色信息做过滤，然后将过滤后的菜单列表以及按钮权限菜单发送给前端。")]),t._v(" "),s("p",[t._v("我们把按钮菜单的标识符，例如用户模块的新增按钮权限user_add，存进一个数组中，然后保存至vuex中，并且设置为getters的属性，可以有缓存。每个组件可以通过mapGetters来注入这个permission数组，然后我们可以在button按钮上的v-if中使用permission是否有这个权限标识符来判断。")]),t._v(" "),s("p",[t._v("并且我们还可以自定义一个指令v-permission，指令的表达式传入一个角色列表，结合vuex中的当前角色来判断，如果在这个列表中，就显示，否则就移除该节点。")]),t._v(" "),s("h2",{attrs:{id:"store"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#store"}},[t._v("#")]),t._v(" Store")]),t._v(" "),s("ol",[s("li",[t._v("common：基础的配置参数")]),t._v(" "),s("li",[t._v("user：用户token、用户信息、角色权限")]),t._v(" "),s("li",[t._v("permission：权限路由")]),t._v(" "),s("li",[t._v("tagView：后台管理的打开标签")]),t._v(" "),s("li",[t._v("log：日志列表")])])])}),[],!1,null,null,null);e.default=a.exports}}]);