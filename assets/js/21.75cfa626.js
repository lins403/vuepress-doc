(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{422:function(t,a,s){"use strict";s.r(a);var n=s(43),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"前端监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端监控"}},[t._v("#")]),t._v(" 前端监控")]),t._v(" "),s("h2",{attrs:{id:"性能监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能监控"}},[t._v("#")]),t._v(" 性能监控")]),t._v(" "),s("ul",[s("li",[t._v("Chrome的 "),s("code",[t._v("Lighthouse")]),t._v(" 可以对网站的质量进行审查，会给出性能评分以及对应的优化建议")]),t._v(" "),s("li",[t._v("一直用的最新的Chrome，现在版本都100了，Chrome的开发工具可太强大了，还可以分析页面的性能、内存、图层、性能监控、渲染、网络状况")])]),t._v(" "),s("h3",{attrs:{id:"监控工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#监控工具"}},[t._v("#")]),t._v(" 监控工具")]),t._v(" "),s("p",[t._v("LightHouse生成网站性能评测报告，会评测网站的性能、SEO评分，并且给出对应的优化建议。")]),t._v(" "),s("p",[t._v("JMeter测试http请求的并发效果，吞吐量等等，可以在控制台的network上看请求的大小和时间、使用Performance API，我们可以设置埋点，在页面 onload 以后利用 performance.getEntriesByType('resource') 获取所有资源加载时间，还可以用performance的mark()和measure()方法来计算时间差。")]),t._v(" "),s("p",[t._v("performance有一些属性可以用于数据采集，例如，performance.memory获取内存使用情况；在页面unload的时候通过浏览器navigator对象的beacon API发送给服务器。")]),t._v(" "),s("p",[s("s",[t._v("最后的优化效果是白屏时间很短，页面的load时间也变短了，这两个时间我们都可以通过在页面上设置埋点收集数据，结合performance的API去计算。我可以在head标签里面添加一个script脚本，脚本中手动去设置一个时间埋点，然后我们需要页面导航开始的时间，这个值通过performance的api去取，performance.timing.navigationStart属性，用这个navigationstart的时间减去我们在页面开始时设置的那个时间埋点，这个时间差大致就是页面白屏的时间。")])]),t._v(" "),s("p",[t._v("也可以设置埋点，比如在DOM解析完成的DOMContentLoaded事件，或者页面解析完成的onload事件触发时，发送数据")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取img资源的加载时长")]),t._v("\nperformance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resource'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resource")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("initiatorType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'img'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"白屏时间-fp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#白屏时间-fp"}},[t._v("#")]),t._v(" 白屏时间(FP)")]),t._v(" "),s("p",[t._v("白屏时间(First Paint)：是指浏览器从响应用户输入网址地址，到浏览器开始显示内容的时间。")]),t._v(" "),s("ul",[s("li",[t._v("白屏时间 = 页面开始展示的时间点 - 开始请求的时间点\n"),s("ul",[s("li",[t._v("responseStart - navigationStart")])])])]),t._v(" "),s("h3",{attrs:{id:"首屏时间-fcp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#首屏时间-fcp"}},[t._v("#")]),t._v(" 首屏时间(FCP)")]),t._v(" "),s("p",[t._v("首屏时间(First Contentful Paint)：是指浏览器从响应用户输入网络地址，到首屏内容渲染完成的时间。")]),t._v(" "),s("ul",[s("li",[t._v("首屏时间 = 首屏内容渲染结束时间点 - 开始请求的时间点\n"),s("ul",[s("li",[t._v("loadEventEnd - navigationStart")])])])]),t._v(" "),s("h3",{attrs:{id:"耗时统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#耗时统计"}},[t._v("#")]),t._v(" 耗时统计")]),t._v(" "),s("blockquote",[s("p",[t._v("通过这些优化，取得比较明显的提升效果，页面的加载效果也好了很多，我们通过埋点计算出来的，首页的白屏时间和页面加载时间都比较合理。通过这次实践，也是去完整的学习了nginx和webpack的构建和配置，加深了对语言和框架、http、以及浏览器的理解和应用")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("重定向耗时：redirectEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" redirectStart\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DNS")]),t._v("查询耗时：domainLookupEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" domainLookupStart\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TCP")]),t._v("链接耗时：connectEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" connectStart\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HTTP")]),t._v("请求耗时：responseEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" responseStart\n解析dom树耗时：domComplete "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" domInteractive\n白屏时间：responseStart "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" navigationStart\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DOM")]),t._v(" ready时间：domContentLoadedEventEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" navigationStart\nonload时间：loadEventEnd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" navigationStart\n")])])]),s("p",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/344120636",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端性能指标：白屏和首屏时间的计算"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"计时工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#计时工具"}},[t._v("#")]),t._v(" 计时工具")]),t._v(" "),s("ol",[s("li",[t._v("Date.now\n"),s("ul",[s("li",[t._v("系统时间，有误差")])])]),t._v(" "),s("li",[t._v("performance.now\n"),s("ul",[s("li",[t._v("更精确")])])]),t._v(" "),s("li",[t._v("performance.mark 和 performance.measure\n"),s("ul",[s("li",[t._v("设置打点，计算埋点之间的时间差")])])]),t._v(" "),s("li",[t._v("console.time 和 console.timeEnd\n"),s("ul",[s("li",[t._v("在控制台中输出，优点是易于使用")])])])]),t._v(" "),s("h2",{attrs:{id:"数据监控-用户行为埋点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据监控-用户行为埋点"}},[t._v("#")]),t._v(" 数据监控/用户行为埋点")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("手工埋点：优点是可定制化，缺点是工作量大且容易出错，更新成本也很大")]),t._v(" "),s("ul",[s("li",[t._v("前端埋点用来记录用户在客户端的操作行为，后端埋点用来记录客户端进行服务器请求的日志。")]),t._v(" "),s("li",[t._v("被访问次数最多的地方，用户在页面的停留时长、浏览深度")]),t._v(" "),s("li",[t._v("通过 sendBeacon 上报，不兼容的情况就用 gif 上报（利用html2canvas结合setTimeout和requestAnimationFrame进行定时截图，或者使用webrtc录制屏幕并结合gifshot将视频转换为gif）")])])]),t._v(" "),s("li",[s("p",[t._v("无埋点：通过设置一段定义好的SDK代码，前端会自动全量采集全部事件并上报埋点数据")])]),t._v(" "),s("li",[s("p",[t._v("可视化埋点：通过第三方平台来设置埋点，实现可视化的页面交互手段来代替编写代码")]),t._v(" "),s("ul",[s("li",[t._v("使用者只需在其可视化埋点页面上，点击想要监测的元素，然后起个名字、给个编号，埋点就完成了")]),t._v(" "),s("li",[t._v("xpath")])])])]),t._v(" "),s("h2",{attrs:{id:"异常监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异常监控"}},[t._v("#")]),t._v(" 异常监控")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" store "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./store'")]),t._v("\n\nVue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("errorHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  Vue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ADD_LOGS'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      message"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      stack"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      info\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'>>>>>> 错误信息 >>>>>>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      \n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'>>>>>> Vue 实例 >>>>>>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      \n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("group")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'>>>>>> Error >>>>>>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("groupEnd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("全局捕获错误，存储到vuex的store中，然后设计一个组件来展示，开发者可以选择清除日志，或者上传日志至服务器。")]),t._v(" "),s("h2",{attrs:{id:"performance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#performance"}},[t._v("#")]),t._v(" Performance")])])}),[],!1,null,null,null);a.default=r.exports}}]);