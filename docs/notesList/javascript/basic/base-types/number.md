# Number

## 浮点数精度

- JavaScript 中所有数字，包括整数和小数都只有一种类型，即 Number类型

- javascript以 <u>64 位双精度浮点数</u>存储所有Number类型值

[number-precision: 🚀1K tiny](https://github.com/nefe/number-precision)

- 实现原理是将浮点数转为整数进行运算（基于「乘法运算」，转成字符串，将小数点replace掉）

### 表示

- Sign bit: 1 bit

- Exponent: 11 bits

- Significand precision: 53 bits (52 explicitly stored)

#### 🌰

```js
27.5 转换为二进制 11011.1
11011.1 转换为科学记数法 1.10111*2^4

符号位 为1(正数)
指数位 为(4 + 指数偏移量1023)，即1027，因为它是十进制的需要转换为二进制即 10000000011
小数部分为10111，补够52位即： 1011 1000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000

符号位+指数位+小数部分 (阶数)
0+10000000011+011 1000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000
```

### 极限值

安全整数

- `Number.MAX_SAFE_INTEGER`

- `Number.MIN_SAFE_INTEGER`

<u>在此范围内的整数和双精度浮点数是一一对应的</u>，不会存在一个整数有多个浮点数表示的情况，当然也不会存在一个浮点数对应多个整数的情况。

`Number.EPSILON`：ES6，极小的常量，目的在于为浮点数计算设置一个误差范围，如果误差能够小于Number.EPSILON，我们就可以认为结果是可靠的。

`Number.isFinite()`

### 精度丢失

计算机存储双精度浮点数，需要先把十进制数转换为二进制的科学记数法的形式，然后计算机以自己的规则 {符号位+(指数位+指数偏移量的二进制)+小数部分} 存储二进制的科学记数法。

因为存储时有位数限制（64位），并且某些十进制的浮点数在转换为二进制数时会出现无限循环，会造成二进制的舍入操作(0舍1入)，当再转换为十进制时就造成了计算误差。

### 拓展

浮点数在机内用指数型式表示，分解为：**数符，尾数，指数符，指数**四部分：

- 数符/符号位 (Sign bit)：占 1 位二进制，表示数的正负。

- 指数符：占 1 位二进制，表示指数的正负。

- 尾数：表示浮点数有效数字，0.xxxxxxx, 但不存开头的 0 和点。

- 指数 (Exponent)：存指数的有效数字。

知道了这四部分的占位，按二进制估计大小范围，再换算为十进制，就是你想知道的数值范围。

#### 单精度浮点数（`float`）

- 在内存中占 4 个字节
- 数符加尾数占 24 位，指数位（指数符加指数）占 8 位，指数偏移量 27-1
- 2^23 = 8388608，一共七位，这意味着最多能有 7 位有效数字，但绝对能保证的为 6 位，也即float的精度为 6~7 位有效数字

#### 双精度浮点数（`double`）

- 在内存中占 8 个字节
- 数符加尾数占 ~~48~~ 53 位，指数符加指数占 ~~16~~ 11 位，指数偏移量 210-1
- 2^52 = 4503599627370496，一共16位，同理，double的精度为15~16 位

## Number运算

```js
1 === 1.0  //true
0.1 + 0.2 === 0.3  //false
0.3 / 0.1  //false
```

```js
NaN === NaN  //false
typeof NaN  //"number"
```

```js
parseInt('16px')  //16
parseInt('110',2)  //6，二进制
parseInt('110',8)  //72，八进制

+'123.456'  //123.456
~~'123.456'  //123
```

```js
Math.floor(Math.PI)  //3
Math.ceil(Math.PI)  //4
Math.round(Math.PI)  //3
Math.PI.toFixed(3)  //'3.142'
```

```js
1 + '2' // '12'
1 - '2' // -1
1 * '2' // 2
1 / '2' // 0.5
```
